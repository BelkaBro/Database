# Домашнее задание к занятию «Резервное копирование баз данных»

## Задание 1. Резервное копирование

Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

В данном случае я бы делал полный бэкап раз в неделю. Потом каждый день инкрементный или дифференциальный бэкап.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

Тут тоже для начала полный бэкап, но желательно раз в день. И потом в течение дня инкрементный, т.к. по занимаемой памяти и времени он будет самый экономный. 

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных
Да, возможен случай, когда при поломке базы данных происходит моментальное переключение на работающую или починенную базу данных. Это может быть реализовано с использованием механизмов репликации и синхронизации данных между несколькими серверами базы данных.
Например, в PostgreSQL можно использовать механизм репликации master-slave, где мастер-сервер принимает все запросы и управляет операциями записи, а slave-серверы синхронизируют свою копию базы данных с мастер-сервером. Если мастер-сервер перестает работать, один из slave-серверов может продолжить работу и обеспечивать доступ к данным.
Также можно использовать механизмы репликации на уровне блока, такие как Distributed Replicated Block Device (DRBD), который позволяет создавать распределенную файловую систему с несколькими реплицированными копиями данных на разных серверах. Если один из серверов выходит из строя, другие серверы продолжают обслуживать запросы и обеспечивать доступ к данным.
В случае поломки базы данных, моментальное переключение на работающую или починенную базу данных может быть реализовано с помощью механизмов репликации и синхронизации данных, которые обеспечивают непрерывную доступность данных и защиту от потери информации.

## Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

Базовая команда `pg_dump <имя_базы> > <файл_сохранения>`.

Команда `pg_restore`  извлекает архивный файл, созданный командой `pg_dump`, и восстанавливает выбранную базу данных PostgreSQL. Для указания базы данных нужно задать параметр `-d` - `pg_restore <имя_базы> <файл_сохранения>`.

2.2.* Возможно ли автоматизировать этот процесс? Если да, то как?

Для этого можно использовать механизмы репликации и синхронизации данных между несколькими серверами базы данных. Например, в PostgreSQL можно настроить автоматическое переключение на рабочую копию базы данных при обнаружении сбоя в мастер-сервере. Для этого можно использовать инструменты мониторинга и управления базами данных, такие как PgBug, которые позволяют отслеживать состояние серверов и выполнять операции восстановления при необходимости.
Также можно использовать механизмы репликации на уровне блока, такие как Distributed Replicated Block Device (DRBD), который позволяет создавать распределенную файловую систему с несколькими реплицированными копиями данных на разных серверах. Если один из серверов выходит из строя, другие серверы продолжают обслуживать запросы и обеспечивать доступ к данным. В этом случае, при обнаружении сбоя в мастер-сервере, можно автоматически переключиться на рабочую копию базы данных.
Автоматизация процесса переключения на рабочую копию базы данных может быть реализована с помощью скриптов и инструментов автоматизации, таких как Ansible или Chef, которые позволяют настроить автоматическое переключение при обнаружении сбоя. Это позволяет обеспечить непрерывную доступность данных и защиту от потери информации в случае поломки базы данных.

## Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

Для данного вида резеревирования используется команда `mysqlbackup` с параметром `--incremental-base=history:last_full_backup`.

Также можно использовать и сторонние утилиты. Например, Percona XtraBackup, которая позволяет делать архивы баз данных на лету без блокировок таблиц. Например, `xtrabackup --backup --target-dir=/backupdb/inc1 --incremental-basedir=/backupdb/full`.


Задания, помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Использование реплики вместо обычного резервного копирования может дать следующие преимущества:

Непрерывная доступность данных: Репликация позволяет обеспечить непрерывную доступность данных даже при сбоях или потере мастер-сервера. Реплицированные копии базы данных могут быть доступны на других серверах, что обеспечивает отказоустойчивость и возможность работы с данными в случае отказа основного сервера.
Высокая производительность: Репликация может улучшить производительность системы, так как данные могут быть распределены и реплицированы на несколько серверов. Это позволяет увеличить пропускную способность и обеспечить более быстрый доступ к данным.
Синхронизация данных: Репликация позволяет синхронизировать данные между несколькими серверами. Это обеспечивает согласованность данных и защиту от потери информации. Если один из серверов выходит из строя, другие серверы могут продолжить работу и обеспечивать доступ к данным.
Масштабируемость: Репликация позволяет легко масштабировать систему, добавляя новые серверы и увеличивая количество реплицированных копий данных. Это позволяет обеспечить высокую доступность и производительность при увеличении нагрузки на систему.
Безопасность: Репликация может обеспечить дополнительную защиту данных, так как каждая реплицированная копия может быть использована для восстановления данных в случае необходимости. Это повышает безопасность и защиту от потери информации.
В целом, использование реплики вместо обычного резервного копирования может обеспечить более надежную, производительную и безопасную работу системы, особенно при работе с большими объемами данных или критически важными приложениями.
